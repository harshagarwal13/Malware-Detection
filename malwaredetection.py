import time
start_time = time.time()

import pandas as pd
data = pd.read_csv("data1.csv",sep = "|")
legit = data[0:41323].drop(["legitimate"],axis = 1)
mal = data[41323::].drop(["legitimate"],axis = 1)


try:
    print("The number of the Legitimate Dataset is :%s samples, %s features"%(legit.shape))
    print("The number of the Malware Dataset is :%s samples, %s features"%(mal.shape))
except AttributeError:
    print("There is no such data")

    
from sklearn.ensemble import ExtraTreesClassifier  
from sklearn.feature_selection import SelectFromModel
from sklearn.model_selection import train_test_split


data_in = data.drop(['Name','md5','legitimate'],axis = 1).values
labels = data['legitimate'].values
extratrees = ExtraTreesClassifier().fit(data_in,labels)
select = SelectFromModel(extratrees,prefit = True)
data_in_new = select.transform(data_in)


import numpy as np
features = data_in_new.shape[1]
importances = extratrees.feature_importances_
indices = np.argsort(importances)[::-1]


legit_train, legit_test, mal_train, mal_test = train_test_split(data_in_new,labels,test_size = 0.2)


from sklearn.tree import DecisionTreeClassifier
from sklearn import metrics
clf = DecisionTreeClassifier()


clf = clf.fit(legit_train,mal_train)

mal_pred = clf.predict(legit_test)
print("Accuracy of detecting Malware :",metrics.accuracy_score(mal_test, mal_pred)*100)

print("Time Taken for complete execution is %.8s seconds"%(time.time() - start_time))